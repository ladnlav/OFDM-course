# Отчет к домашнему заданию №1: Базовый OFDM приёмник-передатчик

## Квинтэссенция работы
В этой работе реализован базовый OFDM приёмник и передатчик в среде программирования Matlab. Пайп лайн сигнала можно увидеть на картинке ниже. В качестве файла для передачи используется картинка орла, которая перводится в битовый формат и затем уже производится QAM-модуляция. При успешном приёме, реализован вывод полученной части картинки.

**Параметры OFDM передачи**
* Сигнальное созвездие: `16QAM`;
* Длительной полезной части в количестве fft отсчётов: `N_fft = 1024`
* Количество поднесущих в одном OFDM символе: `N_carrier = 400`
* Длина защитного интервала: `T_Guard = Nfft/8`
* Количество кадров: `Amount_OFDM_Frames = 10`
* Количество генерируемых OFDM символов: `Amount_OFDM_Symbols_per_Frame = 5`

![Alt-text](<graphs/task1.png>)
_Рисунок №1. Пайплайн OFDM-системы_

![Alt-text](<graphs/eagle.jpg>)

_Рисунок №2. Передаваемая картинка_
## Cтруктура OFDM-символа
* Защитный интервал: это часть сигнала, вставляемая между символами OFDM для сохранения возможности демодуляции OFDM-сигнала в присутствии многолучевых помех, таких как отражения сигнала и разные задержки лучей этого сигнала. Защитный интервал обеспечивает ортогональность между символами, позволяя правильно разделять их в приемнике. Соответственно, минимальная длительность защитного интервала выбирается исходя из максимальной задержки в рассматриваемом канале. В данной работе защитный интервал реализован в виде копии конечной части символа OFDM, добавляемой в начало этого же символа (cyclic prefix).
![Alt-text](<graphs/GI.png>)
_Рисунок №3. Схема добавления защитного интервала по принципу циклического префикса_
* Data carriers: это поднесущие, которые передают фактические данные. Каждая поднесущая содержит в себе информацию об IQ-точке из общего потока данных.
* Pilot Carriers: это поднесущие, которые содержат в себе известные значения для осуществления оценки канала и эквалайзинга на приемнике. Пилоты встраиваются в сигнал вместе с данными на этапе формирования полосы сигнала. Они обеспечивают контрольные точки для определения канальной характеристики и её компенсации.
* Null Carriers _(опционально)_: в некоторых системах OFDM определенные поднесущие могут не использоваться для передачи данных или контрольных символов. Эти нулевые несущие помогают в дальнейшем уменьшении помех между соседними поднесущими.
![Alt-text](<graphs/symbol_structure_2.png>)
_Рисунок №4. Структура OFDM-символа в частотной области_

## АЧХ сигнала на основе OFDM
На рисунке № 5 представлен график амплитудно-частотной характеристики (АЧХ) OFDM-сигнала. Если быть точнее, то это усреднённая по 50 единицам АЧХ одного OFDM-символа. Сама АЧХ построена по уже сформированному OFDM-сигналу во времённой области путём взятия прямого пробразования Фурье. В силу усреднения можно наблюдать различные уровни амплитуды внутри эффективной полосы сигнала (у АЧХ одного OFDM-символа набор значений амплитуд меньше, см. рисунок №4). Также отчётливо видны пилотные поднесущие, которые всё так же принимают нулевое значение. В целом, график такой, какой и ожидался: `N_carrier=400 отсчётов`, на которых мы "расположили" наши данные и пилотные значения. 

__Ремарка насчёт пилотов: вообще, в данной работе не подразумевается их наличие. Здесь они присутствуют в силу следующих причин: 1) удобство для будущего кода; 2) большая наглядность, для чего пилотным поднесущим и было присвоено нулевое значение - его легко обнаружить на графике.__
![Alt-text](<graphs/achx.png>)
_Рисунок №5. Усреднённая по всему сигналу АЧХ одного OFDM-символа_

## АЧХ и сигнальное созвездие на этапе «получение точек созвездия»
Рассмотрим всего 4 случая (case): 
1. Идеальная временная синхронизация - когда мы правильно определили начало символа;
2. Ситуация, когда мы предполагаем начало OFDM-символа до действительного начала этого символа, но после максимальной задержки в канале;
3. Ситуация, когда мы предполагаем начало OFDM-символа до действительного начала этого символа, но теперь до максимальной задержки в канале;
4. Ситуация, когда мы предполагаем начало OFDM-символа позже действительного его начала. 
   
![Alt-text](<graphs/cases.png>)
_Рисунок №6. Различные случаи временной рассинхронизации_

Все эти случаи показаны на `рисунке №6`. Теперь же посмотрим на АЧХ и сигнальное созвездие для каждого случая, за исключением 3, поскольку в рамках этой работы не предполагается моделирование многолучевого распространения, в силу чего для этого случая будет только приведено объяснение происходящего.

### Случай 1. Идеальная временная синхронизация
![Alt-text](<graphs/achx1.png>)
_Рисунок №7. АЧХ при идеальной временной синхронизации_

![Alt-text](<graphs/scatter1.png>)
_Рисунок №8. Сигнальное созвездие при идеальной временной синхронизации_

Как и ожидалось, сигнальное созвездие является эталонным созвездием для выбранного типа модуляции - 16QAM, а АЧХ в точности совпадает с графиками рассмотренными ранее, например, на рисунке №4.

### Случай 2. Опережение синхронизации (после максимальной задержки)
![Alt-text](<graphs/achx2.png>)
_Рисунок №9. АЧХ при опережении синхронизации_

![Alt-text](<graphs/scatter2.png>)
_Рисунок №10. Сигнальное созвездие при опережении синхронизации_

Как можно видеть, АЧХ не проявляет каких-либо видимых изменений, в то время как сигнальное созвездие "закрутилось". Из курса по одночастотной связи известно, что такое происходит при фазовой рассинхронизации, из чего можно выдвинуть предположение, что такой случай временной рассинхронизации приводит к фазовому сдвигу сигнала. Убедимся в этом с помощью математики:
![Alt-text](<graphs/case2.png>)
_Рисунок №11. Объяснение случая №2: опережения синхронизации_

**Таким образом, опережение синхронизации приводит к фазовому сдвигу и как мы увидим далее - пожалуй, это наиболее легко компенсируемый случай временной рассинхронизации.**

### Случай 3. Сильное опережение синхронизации (до максимальной задержки)
![Alt-text](<graphs/achx3.png>)
_Рисунок №12. АЧХ при сильном опережении синхронизации_

![Alt-text](<graphs/scatter3.png>)
_Рисунок №13. Сигнальное созвездие при сильном опережении синхронизации_

АЧХ и сигнальное созвездие мало чем отличается от случая 2, поскольку как уже было отмечено ранее, в этой работе не моделируется многолучевое распространение. Но объяснение следующее: синхронизация символов слишком ранняя для предотвращения межсимвольной интерференции (ISI). В этом случае ортогональность между символами нарушается из-за ISI (от предыдущего символа), и, более того, происходит межканальная интерференция (ICI).

![Alt-text](<graphs/case3.png>)
_Рисунок №14. Сигнальное созвездие при сильном опережении синхронизации с многолучевым распространением_

**Таким образом, сильное опережение синхронизации приводит к межсимвольной интерференции (ISI) и межканальная интерференции (ICI), поскольку наш текущий символ "накладывается" на задержанный предыдущий символ.**

### Случай 4. Задержка синхронизации
![Alt-text](<graphs/achx4.png>)
_Рисунок №15. АЧХ при задержке синхронизации в 1 отсчёт_

![Alt-text](<graphs/scatter4.png>)
_Рисунок №16. Сигнальное созвездие при задержке синхронизации в 1 отсчёт_

![Alt-text](<graphs/achx4_1.png>)
_Рисунок №17. АЧХ при задержке синхронизации в T_Guard/2 отсчётов_

![Alt-text](<graphs/scatter4_1.png>)
_Рисунок №18. Сигнальное созвездие при задержке синхронизации в T_Guard/2 отсчётов_

![Alt-text](<graphs/achx4_2.png>)
_Рисунок №19. АЧХ при задержке синхронизации в T_Guard отсчётов_

![Alt-text](<graphs/scatter4_2.png>)
_Рисунок №20. Сигнальное созвездие при задержке синхронизации в T_Guard отсчётов_

Как можно видеть на графиках АЧХ для трёх случаев задержки синхронизации, амплитуды начинают изменяться и "прыгать". Сигнальные созвездия сначала "закручиваются", а потом и меняются по амплитуде своих точек. Таким образом, наблюдаются как фазовые сдвиги, так и амплитудные скачки. Можно предположить, что это происходит в силу межсимвольной интерференции (ISI). Убедимся в этом:

![Alt-text](<graphs/case4.png>)
_Рисунок №21. Объяснение происходящего при задержке синхронизации_

**В последней строке наших выкладок второй член говорит о наличии межканальной интерференции (ICI) (если учесть многолучевое распространение, то из рисунка №6 понятно, что ICI следовало ожидать). А третий член в этой же последней строке свидетельствует о присутствии межсимвольной интерференции (ISI).**

**Таким образом, задержка синхронизации приводит к межсимвольной интерференции (ISI) и межканальная интерференции (ICI).**


И напоследок, вот что получится, если идеально всё скомпенсировать:
<img src="graphs/rx_pic.png" alt="Alt-text" style="zoom: 33%;" />

_Рисунок №22. Принятая картинка_