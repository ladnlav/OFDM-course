# Отчет к домашнему заданию №3: Искажения канала. Многолучевое распространение

## Квинтэссенция работы
 В этой работе (рисунок 1) рассмотрено влияние различных канальных искажений (АБГШ, временная рассинхронизация, частотная рассинхронизация и многолучевое распространение) на OFDM-сигнал. Для исследования этого влияния использовались: сравнение АЧХ сигнала, сравнение сигнального созвездия после прохождения канала; рассчёт BER и MER в зависимости от различных значений SNR.

 ![Alt-text](<graphs/task3.png> "Пайп-лайн задания")

_Рисунок №1. Пайплайн OFDM-системы_

**Параметры OFDM передачи**
* Сигнальное созвездие: `16QAM`;
* Длительной полезной части в количестве fft отсчётов: `N_fft = 1024`
* Количество поднесущих в одном OFDM символе: `N_carrier = 400`
* Длина защитного интервала: `T_Guard = Nfft/8`
* Количество кадров: `Amount_OFDM_Frames = 10`
* Количество генерируемых OFDM символов: `Amount_OFDM_Symbols_per_Frame = 5`
* Количество пилотных поднесущих (процент от полосы):
`Percent_pilot = 15`
* Амплитуда пилотных значений:
`4/3*максимальная_амплитуда_созвездия`

 Далее в отчёте рассматриваются различные искажения и проявление на графике АЧХ полезной части ofdm-символа и сигнальном созвездии, в качестве некоторой "отправной точки", возьмём АЧХ и сигнальное созвездие в ситуации отсутствия помех (рисунки 2,3) - "чистый" канал.

 ![Alt-text](<graphs/clean_sig.png> "График №1. АЧХ при отсутствии помех")

 _Рисунок №2. АЧХ при отсутствии помех_

 ![Alt-text](<graphs/sc_clean.png> "График №2. Сигнальное созвездие при отсутствии помех")

_Рисунок №3. Сигнальное созвездие при отсутствии помех_

## Аддитивный белый Гауссовский шум (АБГШ)
 Рассмотрение помех начнём с АБГШ. Итак, при `SNR=25 dB` имеем графики на рисунках 4,5.

 ![Alt-text](<graphs/25snr_sig.png> "График №3. АЧХ при АБГШ (SNR=25dB)")

 _Рисунок №4. АЧХ при АБГШ (SNR=25dB)_

 ![Alt-text](<graphs/sc_noise.png> "График №4. Сигнальное созвездие при АБГШ (SNR=25dB)")

_Рисунок №5. Сигнальное созвездие при АБГШ (SNR=25dB)_

 #1. Как можно видеть, АЧХ приобрела чётко выраженные флуктуации по всей полосе спектра. В то же время на сигнальном созвездии исходные точки превратились в "облака" вокруг исходных точек. Очевидно, что при увеличении мощности накладываемого шума, амплитуда появившихся флуктуаций на графике АЧХ и размер "облаков" будут становиться больше.

 ![Alt-text](<graphs/mer.png>)

_Рисунок №6. Формула для вычисления MER_

 ![Alt-text](<graphs/snr.png>)

_Рисунок №7. Формула для вычисления SNR_

 #2. Кроме того, была рассчитана такая характеристика сигнала, как Modulation-Error-Ratio (MER). Вычисляется по формуле на рисунке 6, SNR же вычисляется по формуле на рисунке 7. Эта характеристика показывает отношение мощности вектора "идеальной точки" к вектору ошибки по отношению к этой самой "идеальной точке" (если мы рассматриваем MER для одной конкретной IQ-точки принятого сигнала - так, там подразумаевается отношение сумм по всем точкам). Собственно, в этом и состоит отличие MER от SNR (signal-to-noise-ratio), ведь вторая характеристика непосредственно показывает отношение мощности сигнала к мощности шума. И хорошо известно, что MER и SNR могут не совпадать по объективным причинам (например, когда ошибка настолько велика, что мы определяем "идеальную точку" для данной принятой IQ-точки неверно). Однако, причина различия MER и SNR на картинке ниже в другом. 
 ![Alt-text](<graphs/info.png> "Различие MER и SNR")
 Эта причина заключается в том, что в моей реализации этого задания SNR задаёт мощность шума, которая размазывается на весь OFDM-сигнал. В то же самое время MER рассчитывается только на основании тех IQ-точек, которые по сути содержат в себе реальные данные (`400 - по количеству поднесущих`). Таким образом, остальные `Nfft-400 точек` при расчёте MER не учитываюся, хотя и "впитывают" часть мощности шума. Кроме того, шум размазывается не только по полосе (не только по поднесущим), но и по времени. У нас имеется защитный интерва, который расширяет OFDM символ во времени.

 #3. Также в рамках задания была рассчитана характеристика BER(SNR) для диапазона шумов от `0dB до 30dB`.
 ![Alt-text](<graphs/ber(snr).png>)

 _Рисунок №8. Характеристика BER(SNR) для различных созвездий_

 На рисунке 8 можно наблюдать ожидаемое поведение кривых - "водопадный спад". Ситуация абсолютно аналогична одночастотной связи - BPSK наиболее помехоустойчивое созвездие.

## Временная рассинхронизация (STO)
 Теперь перейдём к рассмотрению эффекта временной рассинхронизации (sampling time offset - STO).
 ![Alt-text](<graphs/3sto_sig.png>)

  _Рисунок №9. АЧХ при STO=37_

 ![Alt-text](<graphs/sc_sto.png>)

  _Рисунок №10. Сигнальное созвездие при STO=37_

 Подробно эффект временной рассинхронизации был рассмотрен в отчете к заданию №1. Здесь же ограничусь кратким комментарием: как можно видеть, АЧХ исходного сигнала теперь вряд ли можно вообще узнать - имеются как фазовые искажения, так и амплитудные. На рисунке АЧХ видно, что присутствует как межсимвольная интерференция (ISI), так и интерференция между поднесущими (ICI). Кроме того, наблюдается внеполосовое излучение, которого раньше не было. Оно вызвано теми отсчётами T_Guard, которые в силу врменного сдвига теперь начали считаться как отсчёты полезной части ofdm-символа.

## Частотной рассинхронизация (CFO)
 ![Alt-text](<graphs/formula_cfo.png>)

 _Рисунок №11. Формула для моделирования частотного сдвига_

 Теперь настало время рассмотреть эффект частотной рассинхронизации (рисунок 11). Стоит отметить, что этот эффект зависит от величины CFO в расстояниях между поднесущими, а именно, эта величина может быть целочисленной (кратной Nfft), а может быть дробной (доля от Nfft). И в зависимости от этого мы будем наблюдать разные эффекты. Для начала взглянем, что вообще происходит с нашими графиками при `CFO = 5`.

 ![Alt-text](<graphs/5cfo_sig.png>)

 _Рисунок №12. АЧХ при CFO=5_

 ![Alt-text](<graphs/sc_cfo.png>)

 _Рисунок №13. Сигнальное созвездие при CFO=5_

 #1. На графике АЧХ (рисунок 12) сразу можно отметить, что полоса поднесущих, которые содержат реальные данные, сместилась на заданное количество отсчётов. При этом на графике сигнального созвездия (рисунок 13) можно наблюдать появление нулевых точек - оно и понятно, ведь теперь вместо первых 5 отсчётов, содержащих данные, мы получили нулевые. Но это не вся правда. Рассмотрим другие значения CFO.

 ![Alt-text](<graphs/001cfo_sig.png>)

 _Рисунок №14. АЧХ при CFO=1% от расстояния между поднесущими_

 ![Alt-text](<graphs/001sc_cfo.png>)

 _Рисунок №15. Сигнальное созвездие при CFO=1% от расстояния между поднесущими_


 ![Alt-text](<graphs/01cfo_sig.png>)

 _Рисунок №16. АЧХ при CFO=0.1 от расстояния между поднесущими_

 ![Alt-text](<graphs/01sc_cfo.png>)

 _Рисунок №17. Сигнальное созвездие при CFO=0.1 от расстояния между поднесущими_

 ![Alt-text](<graphs/100cfo_sig.png>)

 _Рисунок №18. АЧХ при CFO=100 расстояний между поднесущими_

 ![Alt-text](<graphs/100sc_cfo.png>)

 _Рисунок №19. Сигнальное созвездие при CFO=100 расстояний между поднесущими_

 #2. На рисунках 14-19 приведены графики для следующих значений CFO в расстояниях между поднесущими: `0,01; 0,1; 100`. Обозначим целочисленные значения как IFO (integer frequency offset), а дробные как FFO (fractional frequency offset). Так вот, наблюдается следующая тендеция:
 * FFO: на графике АЧХ начинают проявляться как частотные, так и фазовые искажения; в то же время сигнальное созвездие тоже показывает как фазовые, так и частотные искажения;
 * IFO: явно заметен сдвиг на графике АЧХ на заданное количество отсчётов; а на сигнальном созвездии изменения только в добавлении нулевых точек.

 ![Alt-text](<graphs/ICI.png>)

 _Рисунок №20. Визуализация ICI_

 Из всех описанных выше изменений можно сделать следующий вывод: **при IFO ортогональность между поднесущими сохраняется, но теряется часть данных; в то же время при CFO ортогональность между поднесущими нарушается (оно и понятно, ведь теперь мы сэмплируем не в точках ортогональности, а в точках, где присутствует интереференция - смотреть рисунок 20), что приводит к межканальной интерференции (ICI) - бОльшим трудностям при попытке извлечь данные из сигнала**.

## Многолучевое распространение
 И наконец рассмотрим эффект многолучевого распространения.

![Alt-text](<graphs/mp1.png>)

 _Рисунок №21. Причины возникновения многолучевого распространения_

 Эффект многолучевого распространения (multipath propagation) - это феномен, который проявляется в радиоволновых системах связи и передачи данных, когда электромагнитные волны (сигнал) достигают приемника не только напрямую от передатчика, но и через различные отражения и рассеяния от окружающих объектов и поверхностей (рисунок 21). Этот процесс создает несколько путей распространения сигнала между передатчиком и приемником.

 При многолучевом распространении сигнал разделяется на несколько компонентов, каждый из которых может пройти различные пути и иметь разные времена задержки при достижении приемника. Это явление обусловлено отражением сигнала от зданий, поверхностей земли, автомобилей, а также рассеянием на атмосферных частицах. Каждое отраженное или рассеянное излучение может иметь разную фазу и амплитуду по сравнению с исходным сигналом.

 ![Alt-text](<graphs/mp2.png>)

 _Рисунок №22. Визуализация задержек различных компонент сигнала_

 ![Alt-text](<graphs/mp3.png>)

 _Рисунок №23. Математическая модель канала с многолучевым распространением (импульсная характеристика)_

 Математически многолучевое распространение можно смоделировать с помощью суммы задержек различных компонентов сигнала (рисунок 22, 23).

 И далее прохождение сигнала через многолучевой канал можно смоделировать представив этот канал как некоторый аналоговый фильтр. Вычислив свёртку нашего сигнала с импульсной характеристикой канала, мы получим принятый сигнал.

 ![Alt-text](<graphs/mp_sig.png>)

 _Рисунок №24. АЧХ при многолучевом распространении_

 ![Alt-text](<graphs/sc_mp.png>)

 _Рисунок №25. Сигнальное созвездие при многолучевом распространении_

 На графике АЧХ (рисунок 24) видно, что теперь теперь наш сигнал приобрёл частнотные замирания (fading), следовательно, имеем частотно-селективный канал, а также прослеживаются три пика, которые соответствуют трём лучам, выражающимся в трёх тапах в импульсной характеристике канала: `channel_taps = [0, 1; 4, 0.6; 10, 0.3]`. В свою очередь на сигнальном созвездии (рисунок 25) "полный бардак" и определить, где и что находится практически невозможно - из чего можно сделать вывод, что данные потеряны. Это произошло из-за изменений амплитуды на некоторых частотах. Однако, в дальнейшем этот эффект может быть скомпенсирован в рамках процедуры эквалайзинга.

 Вообще может быть два типа замираний: частотно-селективные, либо амплитудные (рисунки 26, 27).

 ![Alt-text](<graphs/flatfading.png>)

 _Рисунок №26. Пример амплитудных замираний_

 ![Alt-text](<graphs/freqselective.png>)

 _Рисунок №27. Пример частотно-селективных замираний_

 Амплитудные замирания характеризуются тем, что внутри полосы нашего сигнала присутствуют незначительные изменения амплитуды. Частотно-селективные замирания, напротив, проявляются в начительных изменениях амплитуды в зависимости от частоты внутри полосы нашего сигнала (рисунок 28).

 ![Alt-text](<graphs/fading.png>)

 _Рисунок №28. Отличия частотно-селективных и амплитудных замираний_